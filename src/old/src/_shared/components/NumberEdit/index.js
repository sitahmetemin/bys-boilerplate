import React, {Component} from 'react';import _ from 'lodash';import is from 'is_js';import {formatNumber} from "../../functions";import './style.css'import classNames from 'classnames'export default class NumberEdit extends Component {    constructor(props) {        super(props);        const {addonSelected, value} = this.props;        this.state = {            ...this.props,            value: addonSelected && !_.isEmpty(addonSelected) ? {                value: _.trim(value),                selected: addonSelected            } : _.trim(value)        }    }    handleChange = (e) => {        const {onChange} = this.props;        let val = e.target.value;        this.setState({            ...this.state,            value: this.state.addonSelect ? {value: _.trim(val), selected: this.state.addonSelected} : _.trim(val)        }, () => {            onChange && this.props.onChange(this.state.value)        })    }    handleBlur = (e) => {        const {onBlur, useThousandSeparator, precision} = this.props;        let val = e.target.value;        if (useThousandSeparator && !precision) {            val = formatNumber(val,'0,0')        }        if (useThousandSeparator && precision) {            val = formatNumber(val,'0,0.' + _.repeat('0', precision))        }        if (!useThousandSeparator && precision) {            val = formatNumber(val,'0.' + _.repeat('0', precision))        }        this.setState({            ...this.state,            value: this.state.addonSelect ? {value: _.trim(val), selected: this.state.addonSelected} : _.trim(val)        }, () => {            onBlur && this.props.onBlur(this.state.value)        })    }    title() {        let {title, id} = this.state;        if (title && !_.isEmpty(title)) {            return <div className="title" id={"alpha_title_" + id}>{title}</div>        }        return null    }    label() {        let {caption, id} = this.state;        if (caption && !_.isEmpty(caption)) {            return <label className="placeholder-label" id={"alpha_label_" + id}>{caption}</label>        }        return null    }    addon(val) {        const {addon, id} = this.state;        if (val && _.find(addon, {position: val})) {            return <span className={'input-group-addon ' + val}                         id={"ariaFirst" + id}>{_.find(addon, {position: val}).text}</span>        }        return ''    }    addonSelect() {        let {addonSelect, addonSelected, displayLabel} = this.state;        let _this = this;        if (addonSelect && is.array(addonSelect) && !_.isEmpty(addonSelect)) {            return <div className="input-group-btn">                <button type="button" className="btn btn-default dropdown-toggle" data-toggle="dropdown"                        aria-haspopup="true" aria-expanded="false">                    {addonSelected[displayLabel]}                    <span className="caret"></span>                </button>                <ul className="dropdown-menu dropdown-menu-right dropdown-select">                    {                        addonSelect.map(function (item, i) {                            return (                                <li                                    className="only-li no-icon"                                    key={i}                                    onClick={() => _this.handleAddonSelect(item)}                                >                                    {item[displayLabel]}                                </li>                            )                        })                    }                </ul>            </div>        }        return ''    };    handleAddonSelect(val) {        const {onChange} = this.props;        let inputValue = this.state.value.selected && !_.isEmpty(this.state.value.selected) ? this.state.value.value : !_.trim(this.state.value);        this.setState({            addonSelected: val,            value: {value: inputValue, select: val}        }, () => {            onChange && this.props.onChange(this.state.value)        })    }    error() {        let {errorMessage, id} = this.state;        if (errorMessage && !_.isEmpty(errorMessage)) {            return <div className="error-container" id={"alpha_error_" + id}>{errorMessage}</div>        }        return null    }    focus = () => {        this.state.ref && this[this.state.ref] && this[this.state.ref].focus();    }    handleKeyDown(e) {        const keycode = e.keyCode,            ctrlKey = e.ctrlKey;        if ((keycode === 65 && ctrlKey) || (keycode === 67 && ctrlKey) || (keycode === 86 && ctrlKey) || (keycode === 88 && ctrlKey)) return;        else if (            (keycode > 64 && keycode < 91) ||            (keycode > 185 && keycode < 188) ||            (keycode > 189 && keycode < 193) ||            (keycode > 218 && keycode < 223)        )            e.preventDefault();        return e.key;    }    render() {        let {readOnly, id, name, disabled, minChar, maxChar, value, addon, errorMessage} = this.state,            igClass = classNames('input-group', {                'data-active': value.selected && !_.isEmpty(value.selected) ? value.value && !_.isEmpty(value.value) : !_.isEmpty(value),                'addon-left': _.find(addon, {position: 'left'}) && !_.isEmpty(_.find(addon, {position: 'left'})),                'addon-right': _.find(addon, {position: 'right'}) && !_.isEmpty(_.find(addon, {position: 'right'})),                'error': errorMessage && !_.isEmpty(errorMessage)            });        // console.log('-->',this.state)        return (            <div className="alpha-edit">                {this.title()}                <div className="alpha-container">                    <div className={igClass}>                        {this.addon('left')}                        <fieldset>                            <input                                id={id}                                type="text"                                name={name}                                disabled={disabled}                                readOnly={readOnly}                                value={this.state.addonSelect ? this.state.value.value : this.state.value}                                className="digi-alpha-input"                                minLength={minChar}                                maxLength={maxChar}                                onChange={(val) => {                                    this.handleChange(val)                                }}                                onClick={this.focus}                                onBlur={(val) => {                                    this.handleBlur(val)                                }}                                onKeyDown={this.handleKeyDown}                                tabIndex={this.state.tabIndex}                                ref={ref => this[this.state.ref] = ref}                            />                            {this.label()}                        </fieldset>                        {this.addon('right')}                        {this.addonSelect()}                        {this.error()}                    </div>                </div>            </div>        );    }}